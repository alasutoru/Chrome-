# 書籤檢查器 (Bookmark Checker)

這是一個 Chrome 瀏覽器擴充元件，旨在幫助使用者掃描、尋找並管理書籤中可能已經失效的連結。

## 💡 用途

隨著時間的推移，我們收藏的書籤中，許多網站可能會關閉、移動或不再存在，這些就成了「失效連結」。這個工具可以解決以下問題：

- **自動化整理**：自動掃描所有書籤，找出疑似無法連線的網站。
- **保持整潔**：幫助你輕鬆移除無用的書籤，讓你的書籤列保持最新且有效。
- **節省時間**：無需手動一個一個點擊來確認連結是否有效。

---

## ✨ 主要功能

- **手動檢查**：可自由選擇檢查「所有書籤」或某個「特定資料夾」。
- **自動檢查**：可啟用「每月自動檢查」，擴充元件會在背景定期執行掃描。
- **結果列表**：清晰地列出所有疑似失效的書籤，包含其標題與連結。
- **圖示提醒**：當發現失效連結時，擴充元件的圖示上會顯示未處理的數量。
- **白名單機制**：
  - 對於某些被誤判的有效連結，可以透過「手動檢查連結」功能將其加入白名單。
  - 加入白名單的連結在一定期限內（預設 30 天）將不會再被回報為失效。
- **多樣化處理**：
  - **單獨刪除**：可針對單一書籤進行刪除。
  - **全部刪除**：可一次性刪除所有已找出的失效書籤。
  - **狀態保存**：未處理的失效連結列表會被保存，即使關閉視窗下次打開依然存在，直到處理完畢。
- **白名單管理**：提供一個獨立的頁面，可以查看所有在白名單中的網站，並可將其從白名單中移除。

---

## 📖 使用方法

1.  **安裝擴充元件**：
    - 在 Chrome 中打開「擴充功能」頁面 (`chrome://extensions`)。
    - 啟用右上角的「開發人員模式」。
    - 點擊「載入未封裝項目」，並選擇本專案的資料夾。

2.  **開始檢查**：
    - 點擊瀏覽器工具列上的「書籤檢查器」圖示。
    - 從下拉選單中選擇你想掃描的範圍（預設為「所有書籤」）。
    - 點擊「開始檢查書籤」按鈕。
    - 程式會顯示進度條，並在完成後列出所有疑似失效的連結。

3.  **處理檢查結果**：
    對於列表中的每一個項目，你可以進行以下操作：
    - **點擊標題**：直接在新分頁中打開該連結，親自確認。
    - **刪除 (❌)**：點擊右側的紅色叉叉按鈕，立即刪除該書籤。
    - **手動檢查 (🔗)**：
        - 點擊「手動檢查連結」按鈕，程式會在新分頁打開該連結，並關閉彈出視窗。
        - 當你確認完畢後，再次點擊擴充元件圖示，會看到一個確認畫面。
        - 如果連結有效，點擊「✅ 是，連結有效」，該連結會被加入白名單，並從此次的失效列表中移除。
        - 如果連結確實失效，點擊「🗑️ 否，連結失效」，該書籤會被刪除。

4.  **啟用自動檢查**：
    - 在主畫面勾選「啟用每月自動檢查」。
    - 擴充元件將會大約每 30 天在背景自動執行一次完整的書籤掃描。
    - 如果發現失效連結，會發送一則桌面通知，並在圖示上顯示數量。

5.  **管理白名單**：
    - 在主畫面點擊「檢視白名單」按鈕。
    - 這裡會列出所有在白名單中的網站及其到期日。
    - 你可以點擊右側的「❌」按鈕，將特定網站從白名單中移除，讓它在下次掃描時被重新檢查。

---

## 🔧 技術說明

這個擴充元件主要利用以下技術實現：

- **連結檢查**：
  - 使用 `fetch` API 搭配 `HEAD` 方法向書籤的 URL 發送請求。`HEAD` 方法只請求標頭（Headers）而不下載整個網頁內容，速度較快。
  - 為了處理跨域請求限制（CORS），`fetch` 在 `no-cors` 模式下運行。
  - **重要提示**：在 `no-cors` 模式下，即使請求成功，腳本也無法讀取回應的狀態碼。因此，判斷失效的依據是 **`fetch` 是否拋出網路層級的錯誤**（例如 DNS 解析失敗、連線被拒絕等）。這可能導致某些設定嚴格的伺服器或需要特殊驗證的網頁被誤判為失效，這也是「白名單」功能存在的主要原因。

- **非同步處理**：
  - 大量使用 `async/await` 來處理非同步操作，例如讀取書籤樹、遍歷檢查、儲存資料等，讓程式碼更清晰。

- **狀態管理**：
  - 使用 `chrome.storage.local` 來儲存使用者的設定（如是否啟用自動檢查）、白名單列表，以及上次檢查後未處理的失效連結列表。這確保了即使關閉彈出視窗，狀態也能被保留。

- **背景任務**：
  - 使用 `chrome.alarms` API 來建立一個週期性鬧鐘，觸發背景腳本 (`background.js`) 中的檢查函式，實現無干擾的自動掃描。

- **使用者介面**：
  - **圖示徽章 (Badge)**：透過 `chrome.action.setBadgeText` 在擴充元件圖示上顯示數字，即時反饋待處理的項目數量。
  - **桌面通知**：透過 `chrome.notifications` API 在背景檢查完成後，主動通知使用者有需要處理的項目。
  - **動態介面**：所有 UI 元素（如進度條、結果列表、按鈕狀態等）都由 `popup.js` 中的 JavaScript 動態生成和控制。